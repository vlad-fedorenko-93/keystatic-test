---
import { getCollection, getEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Tag from "../../components/Tag.svelte";
import Button from "../../components/Button.svelte";

export async function getStaticPaths() {
    const portfolio = await getCollection("portfolio");

    return portfolio.map((caseStudy, index) => ({
        params: { slug: caseStudy.slug },
        props: { id: index },
    }));
}

const { slug } = Astro.params;
if (!slug) throw new Error("Slug not found");

const caseStudy = await getEntry("portfolio", slug);

const portfolio = await getCollection("portfolio");
const prevCaseStudy = !portfolio[Astro.props.id - 1]
    ? portfolio[portfolio.length - 1]
    : portfolio[Astro.props.id - 1];
const nextCaseStudy = !portfolio[Astro.props.id + 1]
    ? portfolio[0]
    : portfolio[Astro.props.id + 1];

const formattedDate = caseStudy.data.year.toLocaleDateString("en-UK", {
  year: "numeric",
});

if (!caseStudy) throw new Error("Case study not found");

const { Content } = await caseStudy.render();
---

<Layout title={caseStudy.data.title}>
    {/* Metadata */}
    <section>
        <div class="grid grid-cols-2 items-center relative m-auto w-3/4 flex items-start py-48">
            <a
                class="absolute top-6 text-md text-slate-500 hover:text-slate-800"
                href="/portfolio">Back to portfolio</a
            >
            <div class="flex flex-col items-start gap-2">
                <h1 class="text-6xl font-bold mb-4">{caseStudy.data.title}</h1>
                 <p class="text-xl mb-8">{caseStudy.data.description}</p>
                <a
                    class="px-4 py-2 bg-slate-200 hover:bg-slate-300 active:bg-slate-400 rounded"
                    href={caseStudy.data.demo}>Live Demo</a
                >
            </div>
            <div class="flex flex-col items-start gap-2">
                <div class="grid grid-cols-2 w-full py-6 border-t border-b border-slate-200">
                    <p class="font-bold text-xl">Category</p>
                    <p class="text-xl">{caseStudy.data.category}</p>
                </div>
                <div class="grid grid-cols-2 w-full py-6 border-b border-slate-200">
                    <p class="font-bold text-xl">Year</p>
                    <p class="text-xl">{formattedDate}</p>
                </div>
                <div class="grid grid-cols-2 w-full py-6 border-b border-slate-200">
                    <p class="font-bold text-xl">Tags</p>
                    <div class="flex gap-2">
                        {caseStudy.data.tags?.map((tag) => <Tag tag={tag} />)}
                    </div>
                </div>
            </div>
        </div>
    </section>
    {/* Thumbnail */}
    <section class="bg-slate-100 h-[800px]"></section>
    {/* Content */}
    <section class="m-auto p-40 w-3/4">
        <Content />
    </section>
    {/* Navigation */}
    <section class="m-auto p-40 w-3/4 grid grid-cols-2 gap-4">
        <Button
            label={"Previous case study"}
            title={prevCaseStudy.data.title}
            slug={prevCaseStudy.slug}
        />
        <Button
            label={"Next case study"}
            title={nextCaseStudy.data.title}
            slug={nextCaseStudy.slug}
        />
    </section>
</Layout>
