---
import { getCollection, getEntry } from "astro:content"
import Layout from "../../layouts/Layout.astro";
import Tag from "../../components/Tag.svelte";
import Button from "../../components/Button.svelte";

export async function getStaticPaths() {
    const portfolio = await getCollection("portfolio");

    return portfolio.map((caseStudy) => ({
        params: { slug: caseStudy.slug },
        props: { id: portfolio.indexOf(caseStudy) } 
    }));
}

const { slug } = Astro.params;
if(!slug) throw new Error("Slug not found");

const caseStudy = await getEntry("portfolio", slug);

const portfolio = await getCollection("portfolio");
const prevCaseStudy = !portfolio[Astro.props.id - 1] ? portfolio[portfolio.length - 1] : portfolio[Astro.props.id - 1];
const nextCaseStudy = !portfolio[Astro.props.id + 1] ? portfolio[0] : portfolio[Astro.props.id + 1];

if(!caseStudy) throw new Error("Case study not found");

const { Content } = await caseStudy.render();
---

<Layout title={caseStudy.data.title}>
    <section class="bg-slate-50">
        <div class="relative m-auto w-3/4 flex flex-col py-48">
            <a
                class="absolute top-6 text-md text-slate-500 hover:text-slate-800"
                href="/portfolio">Back to portfolio</a
            >
            
            <h1 class="text-6xl font-bold mb-4">{caseStudy.data.title}</h1>
            <div class="flex gap-2">{caseStudy.data.tags?.map((tag) => <Tag tag={tag} />)}</div>
        </div>
    </section>
    <section class="m-auto p-40 w-3/4">
        <Content />
    </section>
    <section class="m-auto p-40 w-3/4 grid grid-cols-2 gap-4">
        <Button label={"Previous case study"} title={prevCaseStudy.data.title} slug={prevCaseStudy.slug}/>
        <Button label={"Next case study"} title={nextCaseStudy.data.title} slug={nextCaseStudy.slug}/>
    </section>
</Layout>
